<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>game 1</title>
    <style>
        canvas {
            border: 1px black solid;
        }
    </style>
    <script src="guagame.js"></script>
    <script src="ball.js"></script>
    <script src="paddle.js"></script>
    <script src="block.js"></script>
</head>
<body>
    <canvas id="id-canvas" width="400px" height="300px"></canvas>

    <script>
        var log = console.log

        var imgFromPath = function(path) {
            var img = new Image()
            img.src = path
            return img
        } 

        var rectIntersects = function(a, b) {
            var o = a
            if(b.y > o.y && b.y < o.y + o.image.height) {
                if(b.x > o.x && b.x < o.x + o.image.width) {
                    return true
                }
            }
            return false
        }

        var __main = function() {
            var game = GuaGame(30)
            var paddle = Paddle()
            var ball = Ball()
            var blocks = []
            
            //初始化block
            for(var i = 0; i < 3; i++) {
                var b = Block()
                b.x = i * 100
                b.y = 50
                blocks.push(b)
            }

            game.update = function() {
                if(game.paused) {
                    return
                }

                ball.move()
                if(paddle.collide(ball)) {
                    ball.bounce()
                }
                for(var i = 0; i < blocks.length; i++) {
                    var b = blocks[i]
                    if(b.collide(ball)) {
                        log("碰撞")
                        b.kill()
                        ball.bounce()
                    }
                }
            }

            game.draw = function() {
                game.drawImage(paddle)
                game.drawImage(ball)

                for(var i = 0; i < blocks.length; i++) {
                    var b = blocks[i]
                    if (b.alive) {
                        game.drawImage(b)
                    }
                }
            }
            game.registerAction('a', function() {
                paddle.moveLeft()
            })
            game.registerAction('d', function() {
                paddle.moveRight()
            })
            game.registerAction('f', function() {
                ball.fire()
            })
        }

        __main()

    </script>
</body>
</html>